---
title: 实用统计学（二）
categories: [Statistic,Theory]
tags:
  - Statistic
  - R
toc: true
abbrlink: e22d4def
date: 2022-07-06 17:30:20
latex: true
---
<!--more-->
# 统计实验与显著性检验
## A/B测试
处理、实验组、对照组、随机化、实验对象、检验统计量
1. A/B 测试有对象，对象会分配给两组处理中的一组
1. 理想情况下，对象是随机指定（即随机分配）给一组处理的
1. 实验组间的差异：
  1. 不同处理的效果
  1. 将对象分配到不同处理过程中的运气因素（一些对象的效果本来就很好，而随机分配可能会导致效果好的对象集中在处理 A 或处理 B 中）
1. 单盲研究 & 双盲研究
  1. 单盲研究中，实验对象本身并不知道自己接受的是处理 A 还是处理 B
  1. 双盲研究是指研究者和协助者（例如医学研究中的医生和护士）都不知道哪个对象接受了哪种处理
1. A/B 测试常用于 Web领域，其中的处理可以是网页的设计、产品的价格、标题用语等。我们需要思考如何遵守随机化的原则。



## 假设检验
零假设(H_0)、备择假设(H_1)、单向（单侧）检验、双向（双侧）检验
- 逻辑是：“鉴于人们倾向于对异常的随机行为做出反应，并将其解释为有意义的真实行为，我们要在实验中证明，组间差异要比偶然性可能导致的差异更极端。”
- 假设检验假定零假设为真，创建“零模型”（一种概率模型），并检验所观察到的效果是否是该模型的合理结果。
- 只控制一类错误概率的检验问题称为显著性假设检验问题
- 两类错误概率都要控制的检验问题称为决策性假设检验问题。
  
  
### 重抽样
- 自助法
- 置换检验（随机化检验、随机置换检验、准确检验）
   - 是否有放回
``` R
    perm_fun <- function(x, nA, nB)
{
  n <- nA + nB
  idx_b <- sample(1:n, nB)
  # setdiff 求向量x与向量y中不同的元素(只取x中不同的元素)
  idx_a <- setdiff(1:n, idx_b)
  mean_diff <- mean(x[idx_b]) - mean(x[idx_a])
  return(mean_diff)
}

set.seed(1)
perm_diffs <- rep(0, 1000)
for (i in 1:1000) {
  perm_diffs[i] = perm_fun(session_times[, 'Time'], 21, 15)
}
```
- 变体（很少用）
  - 穷尽（exhaustive）置换检验
  - 自助（bootstrap）置换检验


### 显著性和p值
- p-value（随机模型生成的结果比观测结果更极端的频数）
  - 估计置换检验的p 值时，可以采用置换检验中生成大于等于观测差异值的检验次数所占的比例
- 第一类错误（错误地将仅由随机性导致的效果判定为真。）
- 第二类错误（错误地将实际为真的效果判定为假的（即由随机性导致的））


### t 检验
t 统计量
　　归一化的检验统计量。(归一化之后才能与参考分布做比较)
t 分布
　　一种用于比较所观测到的 t 统计量的参考分布。对于t 检验，参考分布是从零假设生成的。
`t.test()`

### 多重检验
概念|定义
---|---
第一类错误|错误地得出一个效果是统计显著的结论。
错误发现率|在多重检验中，犯第一类错误的比率。
p 值校正|用于在同一数据上做多重检验。
过拟合|拟合了噪声

### 自由度
自由度是归一化检验统计量计算的一部分。它使得归一化后的结果可以与参考分布（例如 t 分布、F 分布等）进行对比
n，即样本规模，在数据中，观测（也称为行或记录）的数量。
d.f.——degrees of freedom（自由度）的简写。
　　
### 方差分析
方差分析是对 A/B 测试中类似过程的一种扩展，用于评估各组之间的整体方差是否落在随机变异范围内。
方差分析的一个有用结果是识别出与组处理、交互效果和误差相关的方差成分

概念|定义
---|---
两两对比|对于有多个组的情况，在两个组之间做假设检验（比如对均值）。
多项检验|一种可以测定多个组均值间方差的单一假设检验。（omnibus test）
方差分解|从整体统计量中（例如，从整体均值、处理均值以及残差中），分离出单个值的贡献情况。
F 统计量|一种归一化统计量，用于衡量多个组均值间的差异是否会超过随机模型的预期。
SS|sum of square（平方和）的简写，指与某一均值的偏差


在比较两组的均值时，可以使用 t 检验替代置换检验。
类似地，对于方差分析而言，存在一种基于 F 统计量的统计检验。
F 统计量基于各组均值间的方差（即处理效果）与由于残差所导致的方差间的比率。比率越高，结果就越统计显著。
如果数据遵循正态分布，根据统计学理论，统计量也应符合某种分布。由此，p 值也是可以计算的
``` R
summary(aov(Time ~ Page, data=four_sessions))
```


双向方差分析


#### 卡方检验
卡方检验适用于计数数据，它可以检验数据与预期分布的拟合程度。
在统计实践中，卡方统计量的最常见用法是与 r×c 列联表一起使用，以评估对变量间独立性的零假设是否合理


卡方检验也是一种重抽样方法

皮尔逊残差
$$
R_p= \frac{x-E(x)}{\sqrt{E(x)}}
$$
卡方统计量是皮尔逊残差的平方和
$\epsilon= \sum_i^r \sum_j^c R_p^2$

`chisq.test(clicks, simulate.p.value=TRUE)`

卡方统计量的分布可以由卡方分布近似得到。适合的标准卡方分布取决于自由度


#### 费舍尔精确检验
卡方分布可以很好地近似混洗重抽样检验过程，但是它并不适用于计数非常低
（达到个位数，特别是少于 5 个）的情况。

在这种情况下，重抽样过程本身就能给出更精确的 p 值。
` fisher.test(clicks)`

卡方检验的大多数标准用法（以及费舍尔精确检验），与数据科学的联系并不是十分紧密。在大多数数据科学实验中，无论是 A/B 测试，还是 A/B/C……测试，==实验目标并不是要简单地确定统计显著性，而是要给出最佳的处理==

#### 多臂老虎机
强化学习/概率论
传统的 A/B 测试基于随机抽样过程，会导致过度地使用非最优处理。
相比而言，多臂老虎机算法改进了抽样过程，加入了在实验过程中学到的信息，减少了非最优处理的频数。
多臂老虎机算法还有助于有效地应对两种以上的处理。
多臂老虎机具有多种不同的算法，能够解决如何将抽样概率从非最优处理转移到（假设的）最优处理的问题
汤普森抽样（Thompson's sampling）【更复杂】



### 检验效能和样本规模
检验效能是指在一定的样品特性（尺寸和变异性）下，检测到指定效果规模的概率
检验效能计算最常用于估计所需的样本规模。
在确定样本的规模之前，需提前确定要执行的统计检验。
必须指定要检测效果的最小规模。
还必须指定检测这一效果规模（检验效能）所需的概率。
最后，还必须指定执行检验的显著性水平（$\alpha$值）。
在计算检验效能或所需的样本规模时，有四个成分是可替换的。它们分别是：
- 样本规模
- 要检测的效果规模
- 执行检验的显著性水平，即$\alpha$值
- 检验效能